# about-charts 产品需求文档（PRD）

本文档规范项目 about-charts 的产品目标、范围、功能、接口与非功能要求，指导后续设计与研发落地。

## 目录

- [背景与目标](#背景与目标)
- [用户与使用场景](#用户与使用场景)
- [信息架构与导航](#信息架构与导航)
- [功能模块](#功能模块)
  - [每日种植计划](#每日种植计划)
  - [数据统计](#数据统计)
  - [我的收获（大屏）](#我的收获大屏)
  - [AI 帮助](#ai-帮助)
- [数据与接口](#数据与接口)
- [非功能性要求](#非功能性要求)
- [依赖、约束与兼容](#依赖约束与兼容)
- [里程碑与验收标准](#里程碑与验收标准)
- [指标与监控](#指标与监控)
- [风控与合规建议](#风控与合规建议)

## 背景与目标

- 通过可视化图表与日常任务管理，帮助用户规划“每日种植计划”、查看“收获总览”，并借助 AI 助手提升效率。
- 提供本地 Mock 数据以便快速演示和开发，后续可无缝切换到真实后端。

## 用户与使用场景

- 目标用户：个人或小团队的种植/学习/任务规划者。
- 核心场景：
  - 规划每日任务、查看时间线、执行番茄钟，提高专注度。
  - 通过数据大屏查看关键指标与异常，快速了解总体情况。
  - 借助 AI 助手进行问答与知识检索，提升信息获取效率。

## 信息架构与导航

- 站点入口 `/` 重定向至 `/activity`。
- 导航结构：
  - `/activity` 顶部导航容器（`BasicLayout`）
    - `/activity/daily` 每日种植计划（默认）
    - `/activity/statistics` 数据统计
    - `/activity/ai` AI 帮助
    - `/activity/bigScreen` 跳转到 `/bigScreen`
  - `/bigScreen` 大屏容器（`BigScreenLayout`）
    - `/bigScreen/dashboard` 收获总览（默认）

## 功能模块

### 每日种植计划

- 页面路径：`/activity/daily`
- 组成：
  - `Timeline` 时间线展示每日关键节点。
  - `ScheduleTask` 任务安排与列表管理。
  - `TodoList` 待办清单展示与勾选。
  - `PomodoroTimer` 番茄钟（当前原型：按钮与布局，后续补计时逻辑与状态）。
- 基本需求：
  - 支持新增/编辑/完成/删除任务（最小可用范围可先完成“新增 + 标记完成”）。
  - 时间线可浏览当天关键节点；支持滚动查看。
  - 番茄钟支持开始/暂停/休息，记录番茄数。
- 验收要点：
  - 任务保存与页面刷新后仍可见（本地存储或后端）。
  - 操作流顺畅，交互状态清晰（按钮文案与禁用逻辑）。

### 数据统计

- 页面路径：`/activity/statistics`
- 内容：后续版本展示任务完成率、番茄数、活跃时间段等图表与统计卡片。
- MVP 验收：页面可正常访问，预留图表容器与接口对接位。

### 我的收获（大屏）

- 页面路径：`/bigScreen/dashboard`
- 组成与图表：
  - 左侧：`PieChart`（玫瑰饼图）、`Line`（面积折线）。
  - 中间：`Summary`（概要指标）、`Count`（计数器）。
  - 右侧：`Ball`（动效球）、`Bar`（柱状图）、`Error`（异常监控）。
- 数据来源：
  - `GET /api/pie` 返回饼图数据（Mock）。
  - `GET /api/error-monitor` 返回异常监控数据（Mock）。
- 交互与性能：
  - 图表使用 ECharts，默认 `renderer: 'svg'`，支持窗口自适应缩放（`useScalePage`）。
  - 图例与富文本标签展示分类名称与销量，保证在 1280×720 以上分辨率可读。

### AI 帮助

- 页面路径：`/activity/ai`
- 能力概述：
  - 基于 `@ant-design/x` 组件实现对话式 UI，支持欢迎词、预设问题、复制/重试等交互。
  - 通过流式接口渲染，支持推理内容与答案内容的增量显示（内部以 `<think>` 包裹推理片段）。
  - 支持附件区（占位实现），后续可支持知识库或上下文上传。
- 数据与安全：
  - 当前样例中存在硬编码的 API Key 与第三方推理地址，仅用于演示。
  - 上线前必须改为环境变量注入，并增加服务端代理与鉴权。

## 数据与接口

### 统一返回结构

```ts
export type Result<T = any> = {
  code: number;
  data: T;
  message: string;
};
```

### 接口列表（Mock）

- 获取饼图数据

```http
GET /api/pie
```

响应示例：

```json
{
  "code": 200,
  "data": [
    { "value": 1048, "name": "Search Engine" },
    { "value": 735, "name": "Direct" },
    { "value": 580, "name": "Email" },
    { "value": 484, "name": "Union Ads" },
    { "value": 300, "name": "Video Ads" }
  ],
  "message": "获取数据成功"
}
```

- 获取异常监控数据

```http
GET /api/error-monitor
```

响应示例：

```json
{
  "code": 200,
  "data": [
    { "id": 1, "name": "异常1", "value": 5, "dur": "10s", "begin": "0s" },
    { "id": 2, "name": "异常2", "value": 3, "dur": "10s", "begin": "-3s" },
    { "id": 3, "name": "异常3", "value": 5, "dur": "10s", "begin": "-5s" }
  ],
  "message": "获取数据成功"
}
```

### 前端数据访问

- 基于 `axios` 封装的 `AxiosService`：
  - `baseURL` 来自 `import.meta.env.VITE_APP_URL`。
  - `request<T>(config)` 返回 `Promise<T>`。

## 非功能性要求

- 性能
  - 首屏大屏渲染时间（FCP）≤ 2.0s（本地 Mock，生产依据网络与设备适当放宽）。
  - 图表切换与自适应缩放无明显卡顿；动画时长与帧率平衡可读性。
- 安全
  - 移除代码中的明文 API Key，使用环境变量与服务端代理。
  - 对 AI 渲染的 Markdown 进行 XSS 安全处理（当前为 `dangerouslySetInnerHTML`，需加入 HTML 白名单或服务端清洗）。
  - 接口鉴权与速率限制由网关/后端负责，前端补充错误态与重试。
- 可用性
  - 关键操作均有可见反馈（加载、禁用、错误提示）。
  - 重要指标组件在 1280×720、1920×1080 下均保持可读。

## 依赖、约束与兼容

- 技术栈：React 18、TypeScript、Vite、React Router、Redux（slices）、Ant Design Pro Components、Ant Design X、ECharts、Axios、Less。
- 运行环境：现代 Chromium 内核浏览器，开发期以桌面端为主。
- 约束：大屏主要适配横屏展示，使用 `useScalePage` 做比例缩放。

## 里程碑与验收标准

- M0（当前）
  - 大屏图表与 Mock 数据跑通；每日计划页面完成基础布局；AI 页面 Demo 可交互。
  - 验收：路由导航与主要页面无报错；图表展示与简单交互可用。
- M1（任务管理功能化）
  - 支持任务新增/完成/删除；番茄钟计时可用并记录次数；统计页展示基础指标。
  - 验收：刷新后任务与番茄数据可持久（localStorage 或后端）。
- M2（数据化与安全化）
  - 接入真实后端（或 Serverless），替换 Mock；AI 接口改为后端代理，移除明文 Key；增加 XSS 防护。
  - 验收：后端鉴权与速率限制生效；前端错误态完备。
- M3（可视化深度与观测）
  - 大屏图表优化与异常明细；埋点与性能监控；统计维度完善。
  - 验收：核心 KPI 达标（见下一节）。

## 指标与监控

- 使用指标：
  - 日任务完成率、番茄钟完成次数、日活访问量。
- 性能指标：
  - 首屏 FCP、可交互时间（TTI）、长任务比率（Long Task）。
- 质量指标：
  - 前端错误率（含图表渲染失败/接口失败）、接口超时率。

## 风控与合规建议

- 外部模型与 API Key：
  - 统一通过服务端代理调用第三方大模型；Key 仅在服务端保存并做权限与配额管理。
  - 前端通过环境变量配置代理地址，避免源代码泄露敏感信息。
- 内容安全：
  - 对 AI 返回内容进行渲染前清洗与敏感词检测（可增设后端内容审核策略）。
- 依赖安全：
  - 锁定依赖版本，定期审计高危漏洞；对图表与 Markdown 渲染库保持更新。

---

变更记录

- v0.1（当前）：首次提交 PRD（覆盖导航、模块、接口、非功能与里程碑）。
